<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>予算審議システム</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >
</head>
<body class="container py-4">

<h1 class="mb-4">予算審議</h1>

<form method="POST">

{% for category in categories %}
<div class="border rounded p-3 mb-4">

    <h3>{{ category.name }}（配分額 {{ category.budget }} 円）</h3>

    {% for club in category.clubs %}
    <div class="mb-2">
        <label class="form-label">{{ club.name }}</label>

        <input
            type="number"
            name="{{ club.id }}"
            class="form-control"
            min="0"
            value="{{ club.value }}"

        >
    </div>
    {% endfor %}

    <ul class="list-group mt-2">
        <li class="list-group-item">
            上限：{{ category.budget }} 円
        </li>
        <li class="list-group-item">
            合計：{{ category.total }} 円
        </li>
        <li class="list-group-item">
            残金：
            <span class="
                {% if category.remaining > 0 %}text-primary
                {% elif category.remaining == 0 %}text-success
                {% else %}text-danger{% endif %}
            ">
                {{ category.remaining }} 円
            </span>
        </li>
    </ul>

    {% if not category.ok %}
        <div class="alert alert-danger mt-2">
            この区分の合計が一致していません
        </div>
    {% else %}
        <div class="alert alert-success mt-2">
            合計が一致しています
        </div>
    {% endif %}

</div>
{% endfor %}

<!-- =========================
     操作ボタン
========================= -->
<div class="mt-4">

    <button
        type="submit"
        name="calculate"
        class="btn btn-outline-primary me-2"
    >
        計算
    </button>

    {% if all_ok %}
        <button
            type="submit"
            name="submit"
            class="btn btn-success"
        >
            提出
        </button>
    {% else %}
        <button
            type="button"
            class="btn btn-secondary"
            disabled
        >
            全区分の合計が一致すると提出できます
        </button>
    {% endif %}

</div>

<hr>

<!-- =========================
     ナビゲーション
========================= -->

<a href="{{ url_for('auth.logout') }}"
   class="btn btn-outline-danger mt-3">
   ログアウト
</a>

{% if session.user.role == "admin" %}
    <a href="{{ url_for('admin.dashboard') }}"
       class="btn btn-outline-secondary mt-3 ms-2">
       管理画面へ
    </a>
{% endif %}

</form>

{% if submitted %}
<div class="alert alert-success mt-4">
    提出が完了しました
</div>
{% endif %}

</body>
</html>
